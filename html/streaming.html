<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>直播</title>
		<meta http-equiv="Expires" content="0" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
		<meta name="format-detection" content="telephone=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta http-equiv="Page-Exit" contect="revealTrans(duration=1.0,transtion=12)">
		<meta http-equiv="Page-enter" contect="revealTrans(duration=1.0,transtion=12)"> 
		<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
		<script>
		(function() {
			var _width = 750;
			var ua = navigator.userAgent;
			if (/Android (\d+\.\d+)/.test(ua)) {
				var version = parseFloat(RegExp.$1);
				if (version > 2.3) {
					document.write('<meta name="viewport" content="width=' + _width + ',user-scalable=no,target-densitydpi=device-dpi,minimal-ui">')
				} else {
					document.write('<meta name="viewport" content="width=' + _width + ',target-densitydpi=device-dpi">')
				}
			} else if (/QQAC_Client_iOS/.test(ua)) {
				document.write('<meta name="viewport" content="width=' + _width + ',maximum-scale=0.5,minimum-scale=0.5">');
			} else {
				document.write('<meta name="viewport" content="width=' + _width + ',user-scalable=no,target-densitydpi=device-dpi,minimal-ui">')
			}
		})();
		</script>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
				max-height: 99999999px;
			}
			/* 顶部样式开始 */
			.head_top{
				width: 100%;
				height: 136px;
				background: #000;
				background-color: rgba(0, 0, 0, 0.5);
				box-shadow: 0px 4px 8px 0px rgba(255, 255, 255, 0.5);
				position: fixed;
				top: 0;
				left: 0;
				padding: 0 32px;
				display: flex;
				align-items: center;
				justify-content: space-between;
				box-sizing: border-box;
				z-index: 99999;
			}
			.head_left{
				display: flex;
				align-items: center;
			}
			.head_title{
				padding: 0 16px;
				box-sizing: border-box;
			}
			.head_title_big{
				font-size: 32px;
				font-weight: 500;
				color: #FFF !important;
				line-height: 44px;
			}
			.head_title_sm{
				font-size: 24px;
				font-weight: 400;
				color: #FFF;
				line-height: 32px;
			}
			.head_logo image{
				width: 88px;
				height: 88px;
				opacity: 1

			}
			.head_btn{
				width: 140px;
				height: 56px;
				background: #E02020;
				border-radius: 10px;
				line-height: 56px;
				text-align: center;
				font-size: 24px;
				font-weight: 500;
				color: #FFFFFF;
				line-height: 56px;
			}
			/* 顶部样式结束 */
			#content{
				padding-bottom: 150px;
			}
			.dis_content{
				padding: 30px 30px 18px;
			}
			.dis_list{
				border-top: 1px solid #f6f6f6;
				padding: 20px 0;
				
			}
			.zan_img{
				width: 30px;
				height: 30px;
				vertical-align: middle;
				margin-top: 8px;
			}
			.dis_img{
				width: 84px;
				height: 84px;
				background-color: #eee;
				border-radius: 50%;
			}
			.dis_txt{
				width: 588px;
				margin-top: 10px;
				
				
			}
			.dis_name{
				color: #25445C;
				font-size: 26px;
			}
			.zhiding{
				width: 80px;
				line-height: 40px;
				border-radius: 10px;
				text-align: center;
				font-size: 24px;
				color: #fff;
				background-color: #ccc; 
				display: inline-block; 
				margin-right: 30px;
				position: relative;
				top: -8px;
			}
			.shenhe{
				line-height: 40px;
				border-radius: 10px;
				text-align: center;
				font-size: 28px;
				color: #333; 
				display: inline-block; 
				margin-right: 20px;
				position: relative;
				top: -4px;
			}
			.shenhe1{
				color: #007AFF;
			}
			.shenhe2{
				color: #555;
			}
			.shenhe3{
				color: red;
			}
			.iconicon_fenxiang_Default{
				color: #666;
				display: inline-block; 
			}
			.dis_num{
				font-size: 26px;
				color: #333;
				
			}
			.iconicon_dianzan_moren{
				display: inline-block;
				font-size: 28px;
				margin-left: 10px;
				position: relative;
				top: -4px;
			}
			.iconicon_dianzan_Highlight{
				display: inline-block;
				font-size: 28px;
				margin-left: 10px;
				position: relative;
				top: -4px;
				color: #F05F58;
			}
			.dis_time{
				font-size: 22px;
				color: #999;
				margin-top: 10px;
			}
			.dis_txt_content{
				color: #333;
				font-size: 28px;
				margin-top: 20px;
				line-height: 40px;
			}
			.addr{
				display: flex;
				flex-direction: row;
				align-items: center;
				font-size:28px;
				padding-left: 102px;
				box-sizing: border-box;
				font-weight:bold;
				color:rgba(58,106,142,1);
				line-height:40px;
			}
			.flex_row{
				display: flex;
				justify-content: space-between;
			}
			.zan_box{
				/* padding: 20px 20px; */
				margin: 0 30px;
				box-sizing: border-box;
				border-radius:10px;
				padding: 0 20px;
				background:rgba(248,248,248,1);
			}
			.iconicon_zan_Default{
				padding-top: 8px;
				font-size: 26px;
				float: left;
				color:rgba(58,106,142,1);
			}
			.penple{
				display: flex;
				font-size:28px;
				line-height: 42px;
				font-weight:400;
				color:rgba(58,106,142,1);
				text-align: justify;
			}
			.zan_penple{
				font-size:28px;
				line-height: 42px;
				padding: 0 20px;
				vertical-align: middle;
				
			}
			.zan_num{
				vertical-align: middle;
			}
			.discuss_box{
				/* padding: 20px 20px; */
				margin: 0 30px;
				margin-top: 20px;
				box-sizing: border-box;
				margin-bottom: 30px;
				background:rgba(248,248,248,1);
				border-radius:10px;
				line-height: 44px;
				position: relative;	
				display: flex;
			}
			.info_content_mes{
				margin-top: 28px;
				margin-left: 20px;
			}
			.iconicon_pinglun_Default{
				color: #3A6A8E;
				font-size: 25px;
				padding-top: 0px;
				float: left;
				font-weight: bold;
			}
			.info_box{
				padding: 20px;
				flex: 1;
			}
			.info_content{
				padding:10px20px;
				padding-bottom: 10px;
			}
			.info_content_item{
				display: flex;
				flex-direction: row;
			}
			.or{
				font-size: 26px;
				color: #bababa;
				text-align: center;
			}
			.btn_more{
				margin-top: 30px;
				font-size:28px;
				font-weight:500;
				color:rgba(58,106,142,1);
				text-align: right;
			}
			.name{
				/* float: left; */
				/* width: 90px; */
				font-size:28px;
				font-weight:400;
				color:rgba(58,106,142,1);
			}
			.info{
				word-break: break-all;
				flex: 1;
				font-size:28px;
				line-height: 42px;
				font-weight:400;
				color:rgba(51,51,51,1);
			}
			.xiazai_bg{
				width: 750px;
				height: 140px;
				position: fixed;
				border-radius: 20px 20px 0 0;
				bottom: 0;
				background-color: rgba(0,0,0,.5);
			}
			.xiazai_bth{
				width: 300px;
				height: 80px;
				background-color: cornflowerblue;
				color: #fff;
				border-radius: 10px;
				font-size: 30px;
				text-align: center;
				line-height: 80px;
				margin-top: 30px;
				position: absolute;
				transform: translateX(-50%);
				left: 50%; 
			}
			
			.dy_box{
				margin-top: 20px;
			}
			
			.query{
				width: 500px;
				height: 500px;
			}
			.img_box1{
				width: 500px;
				height: 500px;
				overflow: hidden;
			}
			.image1{
				width: 100%;
				height: 100%;
				object-fit: cover;
			}
			.img_box2{
				width: 240px;
				height: 240px;
				overflow: hidden;
				float: left;
				margin-right: 20px;
				margin-top: 20px;
			}
			.image2{
				width: 100%;
				height: 100%;
				object-fit: cover;
				float: left;
			}
			.img_box3{
				width: 176px;
				height: 176px;
				overflow: hidden;
				float: left;
				margin-right: 20px;
				margin-top: 20px;
			}
			.image3{ 
				width: 100%;
				height: 100%;
				object-fit: cover;
				float: left;
			}
			.stream_title{
				font-size: 32px;
				line-height: 48px;
				padding: 20px;
				color: #333;
				font-weight: bold;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			.stream_video1,.stream_video2{
				width: 750px;
				height: 420px;
				background-color: #f2f2f2;
				display: none;
			}
			.stream_content{
				font-size: 28px;
				line-height: 40px;
				padding: 20px;
				color: #444;
			}
			.flex{
				padding: 20px;
				display: flex;
				justify-content: space-between;
				font-size: 24px;
				color: #666;
			}
		</style>
	</head>
	<body>
		<!-- 头部开始 -->
		<div class="head_top">
			<div class="head_left">
				<div class="head_logo">
					<image src="./img/icon_logo.png"></image>
				</div>
				
				<div class="head_title">
					<p class="head_title_big">筑梦裕安</p>
					<p class="head_title_sm">打开筑梦裕安APP，体验更佳！</p>
				</div>
			</div>

			<div class="head_btn">
				立即打开
			</div>
		</div>
		<!-- 头部结束 -->
		
		<!-- 直播内容 -->
		<div class="streaming_box">
			<div class="stream_title"></div>
			<div>
				<!-- <video class="stream_video1" controls loop="loop" width="800" height=""></video> -->
				<img class="stream_video1" src="" alt="">
				<img class="stream_video2" src="" alt="">
			</div>
			<div class="stream_content"></div>
			<div class="flex">
				<div class="stream_time"></div>
				<div class="stream_num"></div>
			</div>
		</div>
		<!-- 动态内容 -->
		<div id="content"></div>
		<!-- <div class="xiazai_bg">
			<div class="xiazai_bth">前往下载</div>
		</div> -->
	</body>
	<script type="text/javascript">
		var advanceId = ''; // 直播id
		var msgUrl='http://112.27.250.251:8104/' // 测试环境
		// var msgUrl='http://116.62.170.111:8081/' // 生产环境
		var path = window.location.protocol + "//" +window.location.host;
		function getParams(){
		    var url=window.location.href;
			if(url.indexOf("?")>0){
				url=url.split("?")[1];
				arr=url.split("&");
				var obj={};
				for(var i=0; i<arr.length; i++){
					var arr_list=arr[i].split("=");
					obj[arr_list[0]]=arr_list[1];
				}
				advanceId = obj.advanceId
			}
		}
		$(function(){
			getParams();
			// 获取默认数据			
			$.ajax({
			    type: 'post',
			    url: msgUrl+"app/liveDynamic/findAdvanceById2",
			    dataType: 'JSON',
				data:{
					advanceId: advanceId
				},
			    success: res => {
					if(res.code == 200){
						$(".stream_title").text('标题：'+res.data.title)
						// 类型，视屏直播1，图文直播2
						if(res.data.liveType == 1){
							$(".stream_video1").css("display",'block')
							$(".stream_video1").attr('src',res.data.imgUrl)
							// $(".stream_video1").attr('src',res.data.imgUrl)
						}else if(res.data.liveType == 2){
							$(".stream_video2").css("display",'block')
							$(".stream_video2").attr('src',res.data.largePicture)
						}
						$(".stream_content").text(res.data.content)
						$(".stream_time").text(res.data.publishTime)
						$(".stream_num").text(res.data.visitNum+'次观看')
					}else if(res.code == 100){
						window.location.href ="./data_error.html"
					}
			    },
			    error: msg => {
			        console.log(msg);
			    }
			})
			
			// 获取动态数据 
			$.ajax({
			    type: 'post',
			    url: msgUrl+"app/liveDynamic/liveDetailList2",
			    dataType: 'JSON',
				data:{
					advanceId: advanceId,
					lastTime: '', //上一条动态发布时间
					pageSize: 30
				},
			    success: res => {
			        // console.log(res);
					if(res.code == 200){
						var str = ''
						for(i=0;i<res.data.list.length;i++){
							// 点赞内容
							var str1 = []
							if(res.data.list[i].likes.length<=10){
								for(var j=0;j<res.data.list[i].likes.length;j++){
									str1.push(res.data.list[i].likes[j].userName+' ')
								}
							}else{
								for(var j=0;j<10;j++){
									str1.push(res.data.list[i].likes[j].userName+' ')
								}
							}
							// 等多少人
							var zanNum = ''
							if(res.data.list[i].likeNum > 10){
								zanNum = '等'+ res.data.list[i].likeNum +'点赞'
							}
							
							// 评论内容
							var str2 = []
							var str4 = ''
							var str10 = ''
							if(res.data.list[i].comments.length>0){
								str4 += 
								"<div class='info_content_mes'>" +
									"<image src='./img/icon_mes.png' class='mes_img'></image>" +
								"</div>"
							}
							for(var k=0;k<res.data.list[i].comments.length;k++){
								str2 +=	
								"<div class='info_content' onclick=toStreamingContent(\"" + res.data.list[i].id +  "\")>"+
									'<div class="info_content_item">'+
										'<div class="name">'+ res.data.list[i].comments[k].userName +'：</div>'+
										'<div class="info">'+ res.data.list[i].comments[k].content +'</div>'+
									'</div>'+
								'</div>'
							}
							if(res.data.list[i].comments.length>0){
								str10 += '<div class="discuss_box">'
												+ str4 +
											'<div class="info_box">'
												+ str2 +
											'</div>'+
										'</div>'
							}
							// 图片视屏内容
							var str3 = '';
							for(var l=0;l<res.data.list[i].pictures.length;l++){
								if(res.data.list[i].pictures[l].type == 1){
									if(res.data.list[i].pictures.length == 1){
										str3 +=
										'<div class="img_box1">'+
											'<img class="image1" src='+ res.data.list[i].pictures[l].pictureUrl +'>'+
										'</div>'
									}else if(res.data.list[i].pictures.length >1 && res.data.list[i].pictures.length <=4 && res.data.list[i].pictures.length != 3){
										str3 +=
										'<div class="img_box2">'+
											'<img class="image2" src='+ res.data.list[i].pictures[l].pictureUrl +'>'+
										'</div>'
									}else if(res.data.list[i].pictures.length >4 || res.data.list[i].pictures.length == 3){
										str3 +=
										'<div class="img_box3">'+
											'<img class="image3" src='+ res.data.list[i].pictures[l].pictureUrl +'>'+
										'</div>'
									}
								}else{
									str3 +=
									'<div class="img_box">'+
										'<video width="500" height="500" controls loop="loop" src='+ res.data.list[i].pictures[l].pictureUrl +'></video>'+
									'</div>'
								}
							}
							//点赞人

							var srt8=''
							if(res.data.list[i].likes.length>0){
								srt8 += "<div class='zan_box' onclick=toStreamingContent(\"" + res.data.list[i].id +  "\")>"+
										'<div class="penple">'+
											"<image src='./img/icon_zan.png' class='zan_img'></image>"+
											'<div>' +
												'<span class="zan_penple">'+ str1 +'</span>'+
												'<span class="zan_num">'+ zanNum +'</span>'+
											'</div>' +
										'</div>'+
									'</div>'
							}
							// 主体内容
							str += 
							'<div>'+
								'<div class="dis_content">'+
									'<div class="dis_list flex_row">'+
										'<image src='+ res.data.list[i].userAvatar +' class="dis_img"></image>'+
										"<div class='dis_txt' onclick=toStreamingContent(\"" + res.data.list[i].id +  "\")>"+
											'<div class="flex_row">'+
												'<div class="dis_name">'+ res.data.list[i].userName +'</div>'+
											'</div>'+
											'<div class="dis_time">'+ res.data.list[i].visitTime +'</div>'+
											'<div class="dis_txt_content">'+ res.data.list[i].content +'</div>'+
											'<div class="dy_box">'+ str3 +'</div>'+
										'</div>'+
									'</div>'+
								'</div>'
									+ srt8 + str10 +
							'</div>'
						}
						$("#content").html(str)
					}
					else{
						$('.discuss_box').css("display","none")
					}
					
			    },
			    error: msg => {
			        console.log(msg);
			    }
			})
		})


		
		$(".xiazai_bth").click(function(){
			window.location.href = path+"/uploads/file/html/index.html";
		});
		$(".stream_video1").click(function(){
			window.location.href = path+"/uploads/file/html/index.html";
		});
		$(".stream_video2").click(function(){
			window.location.href = path+"/uploads/file/html/index.html";
		});
		$(".head_btn").click(function(){
			window.location.href = path+"/uploads/file/html/index.html";
		});

		function toStreamingContent(detailId){
			console.log(detailId,"detailId")
			window.location.href ="./streamingContent.html?detailId=" + detailId
		};
	</script>
	
</html>